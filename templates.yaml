# List of template blocks
- sensor:
    # ---- Pressure trend (rising / steady / falling) ----
    - name: KNEPLATT72 Pressure Trend
      unique_id: kneplatt72_pressure_trend
      state: >-
        {% set u = state_attr('sensor.kneplatt72_pressure','unit_of_measurement') or '' %}
        {% set d = states('sensor.kneplatt72_pressure_24h_change')|float(0) %}
        {% set delta_hpa = d if u in ['hPa','mbar'] else (d * 33.8638866667) %}
        {% if delta_hpa > 0.7 %}rising{% elif delta_hpa < -0.7 %}falling{% else %}steady{% endif %}
      icon: >-
        {% set s = this.state %}
        {% if s == 'rising' %}mdi:arrow-up-bold
        {% elif s == 'falling' %}mdi:arrow-down-bold
        {% else %}mdi:arrow-right-bold
        {% endif %}
      attributes:
        delta_hpa: >-
          {{ (
              states('sensor.kneplatt72_pressure_24h_change')|float(0) *
              (33.8638866667 if (state_attr('sensor.kneplatt72_pressure','unit_of_measurement') not in ['hPa','mbar']) else 1)
            ) | round(2) }}
        delta_inhg: >-
          {{ (
              (states('sensor.kneplatt72_pressure_24h_change')|float(0) / 33.8638866667)
              if (state_attr('sensor.kneplatt72_pressure','unit_of_measurement') in ['hPa','mbar'])
              else states('sensor.kneplatt72_pressure_24h_change')|float(0)
            ) | round(3) }}
        threshold_hpa: "3.0"

    # ---- Nmap metrics ----
    - name: Nmap Active Hosts
      unique_id: nmap_active_hosts
      state: >-
        {% set nmap = integration_entities('nmap_tracker') %}
        {{ expand(nmap)
            | selectattr('domain', 'equalto', 'device_tracker')
            | selectattr('state', 'equalto', 'home')
            | list | length }}
      icon: mdi:lan

    - name: Nmap Known Hosts
      unique_id: nmap_known_hosts
      state: >-
        {% set nmap = integration_entities('nmap_tracker') %}
        {{ expand(nmap)
            | selectattr('domain', 'equalto', 'device_tracker')
            | list | length }}
      icon: mdi:lan-check

    # ---- Internet status (Ping entities) ----
    - name: Internet Status
      unique_id: internet_status
      state: >-
        {% if is_state('binary_sensor.internet_reachable','on') %}
          Online ({{ states('sensor.internet_reachable_latency') }} ms)
        {% else %}
          Offline
        {% endif %}
      icon: >-
        {% if is_state('binary_sensor.internet_reachable','on') %}
          mdi:check-network
        {% else %}
          mdi:close-network
        {% endif %}

    # ---- Huskers test sensor (mirrors input_text) ----
    - name: "Huskers Last Score (test)"
      unique_id: huskers_last_score_test
      state: "{{ states('input_text.huskers_last_score') or 'â€”' }}"
      icon: mdi:scoreboard
