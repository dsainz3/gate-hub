# Repository metrics package generated by automation builder
#
# Exposes a command_line sensor that surfaces the summary JSON produced by
# scripts/metrics.py. The sensor can be used in automations, badges or other
# dashboards to display high-level GitHub stats.

command_line:
  - sensor:
      name: GitHub Repo Metrics Summary
      unique_id: github_repo_metrics_summary
      command: "cat /config/www/metrics/summary.json"
      scan_interval: 3600
      value_template: "{{ value_json.highlights['Weekly commits'] | default('n/a') }}"
      json_attributes:
        - generated_at
        - highlights
        - lines_added
        - lines_deleted
        - contributors_last_week
        - status
        - message

template:
  - sensor:
      - name: GitHub Weekly Contributors
        unique_id: github_repo_metrics_weekly_contributors
        unit_of_measurement: people
        state: >-
          {{ state_attr('sensor.github_repo_metrics_summary', 'contributors_last_week') | default(0) }}
        availability: >-
          {{ state_attr('sensor.github_repo_metrics_summary', 'contributors_last_week') is not none }}
