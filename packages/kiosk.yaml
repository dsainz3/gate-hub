###############################################################################
# KIOSK — clean groups + simple one-tap scripts (no segment lights)
###############################################################################

group:
  # Core, non-segment lights you actually have
  kiosk_all_lights_core:
    name: Kiosk — All Lights (Core)
    entities:
      - light.all_lights
      - light.office_lights
      - light.theater_lights
      - light.front_porch_lights
      - light.all_exterior_lights
      - light.permanent_outdoor_lights
      - light.light_theater_left
      - light.light_theater_right
      - light.light_front_left
      - light.light_front_right
      - light.light_garage_center
      - light.light_garage_left
      - light.light_garage_right
      - light.light_parents
      - light.light_guest_room
      - light.light_attic
      - light.sunroom_light
      - light.livingroom_light
      - light.diningroom_light
      - light.light_office
      - light.spare_light

  kiosk_theater_lights:
    name: Kiosk — Theater Lights
    entities:
      - light.theater_lights
      - light.light_theater_left
      - light.light_theater_right

  kiosk_front_lights:
    name: Kiosk — Front Lights
    entities:
      - light.front_porch_lights
      - light.light_front_left
      - light.light_front_right

  kiosk_garage_lights:
    name: Kiosk — Garage Lights
    entities:
      - light.light_garage_center
      - light.light_garage_left
      - light.light_garage_right

  kiosk_all_automations:
    name: Kiosk — Core Automations
    entities:
      - automation.evening_lights_at_sunset
      - automation.night_mode_at_midnight
      - automation.early_morning_lights_0330
      - automation.interior_lights_sunrise_off
      - automation.exterior_front_garage_on_sunset
      - automation.exterior_lights_sunrise_off
      - automation.exterior_led_monthly_effect
      - automation.humidor_plug_temp_control
      - automation.burner_plugs_off_2300

  # Exterior-only (no segments)
  kiosk_exterior_lights:
    name: Kiosk — Exterior Lights
    entities:
      - light.all_exterior_lights
      - light.permanent_outdoor_lights
      - light.front_porch_lights
      # keep this commented if it doesn’t behave like a real group for you
      # - light.lights_exterior

  # Purifier power switches
  kiosk_purifiers:
    name: Kiosk — Purifiers
    entities:
      - switch.bedroom_purifier_power_switch
      - switch.guest_room_purifier_power_switch
      - switch.garage_air_purifier_power_switch

  # Smart plugs / safety shutoffs
  kiosk_plugs:
    name: Kiosk — Plugs
    entities:
      - switch.plug_basement_burner
      - switch.plug_mainfloor_burner
      - switch.plug_bedroom_burner
      - switch.plug_humidor
      - switch.tree_power_switch

  # Light “power switch” relays (for Govee/relays/etc) — no segments
  kiosk_light_power_switches:
    name: Kiosk — Light Power Switches
    entities:
      - switch.bar_light_power_switch
      - switch.diningroom_light_power_switch
      - switch.livingroom_light_power_switch
      - switch.light_parents_power_switch
      - switch.light_guest_room_power_switch
      - switch.sunroom_light_power_switch
      - switch.light_attic_power_switch
      - switch.permanent_outdoor_lights_power_switch
      - switch.exterior_lights_power_switch
      - switch.outside_power_switch
      - switch.main_power_switch
      - switch.mainfloor_power_switch
      - switch.main_floor_power_switch
      - switch.light_ari_power_switch
      - switch.christmas_tree_lights_power_switch
      - switch.tv_lights_power_switch
      - switch.scenic_dreamview_power_switch
      - switch.scenic_dreamview1_power_switch
      - switch.scenic_dreamview2_power_switch

  # Snapshot quick reference bundles
  kiosk_snapshot_weather:
    name: Kiosk - Snapshot Weather
    entities:
      - !secret weather_primary_entity
      - sensor.outdoor_temperature_wx
      - sensor.outdoor_humidity_wx
      - sensor.outdoor_wind_speed_wx
      - sensor.outdoor_pressure_wx

  kiosk_snapshot_huskers:
    name: Kiosk - Snapshot Huskers
    entities:
      - sensor.huskers_next_game
      - sensor.huskers_record_dashboard
      - sensor.huskers_game_status_espn
      - sensor.huskers_kickoff_in_effective
      - binary_sensor.huskers_is_pregame_espn
      - binary_sensor.huskers_is_live_espn
      - binary_sensor.huskers_is_postgame_espn

  kiosk_snapshot_lights:
    name: Kiosk - Snapshot Lights
    entities:
      - light.all_lights
      - light.all_exterior_lights
      - group.kiosk_theater_lights
      - group.kiosk_front_lights
      - group.kiosk_garage_lights

  kiosk_snapshot_auxiliary:
    name: Kiosk - Snapshot Auxiliary
    entities:
      - switch.plug_humidor
      - sensor.hygrometer_humidor_temperature
      - sensor.hygrometer_humidor_humidity
      - switch.plug_basement_burner
      - switch.plug_mainfloor_burner
      - switch.plug_bedroom_burner
      - switch.tree_power_switch

  kiosk_snapshot_automations:
    name: Kiosk - Snapshot Automations
    entities:
      - automation.evening_lights_at_sunset
      - automation.night_mode_at_midnight
      - automation.early_morning_lights_0330
      - automation.interior_lights_sunrise_off
      - automation.exterior_front_garage_on_sunset
      - automation.exterior_lights_sunrise_off
      - automation.exterior_led_monthly_effect
      - automation.humidor_plug_temp_control
      - automation.burner_plugs_off_2300

###############################################################################
# Scripts (mapping style; aliases quoted)
###############################################################################
script:
  kiosk_all_lights_on:
    alias: 'Kiosk: All Lights — ON'
    mode: single
    sequence:
      - service: light.turn_on
        target:
          entity_id: group.kiosk_all_lights_core

  kiosk_all_lights_off:
    alias: 'Kiosk: All Lights — OFF'
    mode: single
    sequence:
      - service: light.turn_off
        target:
          entity_id: group.kiosk_all_lights_core

  kiosk_exterior_on:
    alias: 'Kiosk: Exterior — ON'
    mode: single
    sequence:
      - service: light.turn_on
        target:
          entity_id: group.kiosk_exterior_lights

  kiosk_exterior_off:
    alias: 'Kiosk: Exterior — OFF'
    mode: single
    sequence:
      - service: light.turn_off
        target:
          entity_id: group.kiosk_exterior_lights

  # Uses your existing kiosk_* scene groups if you prefer; otherwise the core group above
  kiosk_theater_on:
    alias: 'Kiosk: Theater — ON'
    mode: single
    sequence:
      - service: light.turn_on
        target:
          entity_id:
            - group.kiosk_theater_lights
            - light.theater_lights

  kiosk_theater_off:
    alias: 'Kiosk: Theater — OFF'
    mode: single
    sequence:
      - service: light.turn_off
        target:
          entity_id:
            - group.kiosk_theater_lights
            - light.theater_lights

  kiosk_front_on:
    alias: 'Kiosk: Front — ON'
    mode: single
    sequence:
      - service: light.turn_on
        target:
          entity_id:
            - group.kiosk_front_lights
            - light.front_porch_lights

  kiosk_front_off:
    alias: 'Kiosk: Front — OFF'
    mode: single
    sequence:
      - service: light.turn_off
        target:
          entity_id:
            - group.kiosk_front_lights
            - light.front_porch_lights

  kiosk_garage_on:
    alias: 'Kiosk: Garage — ON'
    mode: single
    sequence:
      - service: light.turn_on
        target:
          entity_id:
            - group.kiosk_garage_lights
            - light.garage_center
            - light.light_garage_left
            - light.light_garage_right

  kiosk_garage_off:
    alias: 'Kiosk: Garage — OFF'
    mode: single
    sequence:
      - service: light.turn_off
        target:
          entity_id:
            - group.kiosk_garage_lights
            - light.garage_center
            - light.light_garage_left
            - light.light_garage_right

  kiosk_purifiers_on:
    alias: 'Kiosk: Purifiers — ON'
    mode: single
    sequence:
      - service: switch.turn_on
        target:
          entity_id: group.kiosk_purifiers

  kiosk_purifiers_off:
    alias: 'Kiosk: Purifiers — OFF'
    mode: single
    sequence:
      - service: switch.turn_off
        target:
          entity_id: group.kiosk_purifiers

  kiosk_plugs_on:
    alias: 'Kiosk: Plugs — ON'
    mode: single
    sequence:
      - service: switch.turn_on
        target:
          entity_id: group.kiosk_plugs

  kiosk_plugs_off:
    alias: 'Kiosk: Plugs — OFF'
    mode: single
    sequence:
      - service: switch.turn_off
        target:
          entity_id: group.kiosk_plugs

  kiosk_light_relays_on:
    alias: 'Kiosk: Light Power Switches — ON'
    mode: single
    sequence:
      - service: switch.turn_on
        target:
          entity_id: group.kiosk_light_power_switches

  kiosk_light_relays_off:
    alias: 'Kiosk: Light Power Switches — OFF'
    mode: single
    sequence:
      - service: switch.turn_off
        target:
          entity_id: group.kiosk_light_power_switches

###############################################################################
# Template sensors - snapshot metrics
###############################################################################
template:
  - sensor:
      - name: kiosk_snapshot_lights_on
        unique_id: kiosk_snapshot_lights_on
        unit_of_measurement: lights
        icon: mdi:lightbulb-on
        state: >-
          {{ expand('group.kiosk_all_lights_core') | selectattr('state','eq','on') | list | length }}
      - name: kiosk_snapshot_plugs_on
        unique_id: kiosk_snapshot_plugs_on
        unit_of_measurement: plugs
        icon: mdi:power-plug
        state: >-
          {{ expand('group.kiosk_plugs') | selectattr('state','eq','on') | list | length }}
      - name: kiosk_snapshot_aux_readout
        unique_id: kiosk_snapshot_aux_readout
        icon: mdi:thermometer-water
        state: >-
          {% set temp = states('sensor.hygrometer_humidor_temperature') %}
          {% set humidity = states('sensor.hygrometer_humidor_humidity') %}
          {% if temp in ['unknown', 'unavailable'] or humidity in ['unknown', 'unavailable'] %}
            Data unavailable
          {% else %}
            {{ temp }} degF / {{ humidity }} %
          {% endif %}
        attributes:
          humidor_plug: "{{ states('switch.plug_humidor') }}"
  - binary_sensor:
      - name: kiosk_snapshot_automation_issue
        unique_id: kiosk_snapshot_automation_issue
        device_class: problem
        state: >-
          {{ expand('group.kiosk_all_automations') | selectattr('state','ne','on') | list | length > 0 }}
        attributes:
          disabled_automations: >-
            {{ expand('group.kiosk_all_automations') | selectattr('state','ne','on') | map(attribute='entity_id') | list }}
