huskers:
  template:
    - sensor:
        - name: "Huskers Next Game Start"
          unique_id: huskers_next_game_start
          state: >
            {{ states('sensor.nebraska_football') }}
          # If the upstream feed is missing, this will just be 'NOT_FOUND'/unknown

        - name: "Huskers Next Game Status"
          unique_id: huskers_next_game_status
          state: >
            {{ 'pregame' if is_state('binary_sensor.huskers_pregame_window','on')
               else 'postgame' if is_state('binary_sensor.huskers_postgame_window','on')
               else 'in_progress' if is_state('binary_sensor.huskers_game_in_progress_tt','on')
               else 'idle' }}

        - name: "Huskers Kickoff In"
          unique_id: huskers_kickoff_in
          unit_of_measurement: "min"
          state: >
            {% set t = states('sensor.huskers_next_game_start') %}
            {% if t not in ['unknown','unavailable','none','', 'NOT_FOUND'] %}
              {% set dt = as_datetime(t) %}
              {% if dt %}{{ ((dt - now()).total_seconds() / 60) | round(0) }}
              {% else %}unknown{% endif %}
            {% else %}unknown{% endif %}

    - binary_sensor:
        - name: "Huskers Pregame Window"
          unique_id: huskers_pregame_window
          state: >
            {% set mins = states('sensor.huskers_kickoff_in')|int(-9999) %}
            {{ 0 < mins <= 120 }}

        - name: "Huskers Postgame Window"
          unique_id: huskers_postgame_window
          state: >
            {{ false }}  {# TODO: implement when you have game end #}

        - name: "Huskers Game In Progress (TT)"
          unique_id: huskers_game_in_progress_tt
          state: >
            {{ false }}  {# TODO: wire to upstream if available #}
