- id: humidor_plug_temp_control
  alias: Humidor Plug – Temperature Control
  description: Turn ON humidor plug when temp > 74°F; turn OFF when temp < 68°F.
  trigger:
    - platform: numeric_state
      entity_id: sensor.hygrometer_humidor_temperature
      above: 74
    - platform: numeric_state
      entity_id: sensor.hygrometer_humidor_temperature
      below: 68
  condition: []
  action:
    - choose:
        - conditions:
            - condition: numeric_state
              entity_id: sensor.hygrometer_humidor_temperature
              above: 74
          sequence:
            - condition: state
              entity_id: switch.plug_humidor
              state: "off"
            - service: switch.turn_on
              target:
                entity_id: switch.plug_humidor
        - conditions:
            - condition: numeric_state
              entity_id: sensor.hygrometer_humidor_temperature
              below: 68
          sequence:
            - condition: state
              entity_id: switch.plug_humidor
              state: "on"
            - service: switch.turn_off
              target:
                entity_id: switch.plug_humidor
  mode: single

- id: outdoor_lights_control
  alias: Outdoor Lights Control - Sunrise/Sunset
  trigger:
    - platform: sun
      event: sunrise
      id: sunrise
    - platform: sun
      event: sunset
      id: sunset
  condition: []
  action:
    - choose:
        - conditions:
            - condition: trigger
              id: sunrise
          sequence:
            - service: light.turn_off
              target:
                entity_id:
                  - light.permanent_outdoor_lights
                  - light.garage_left
                  - light.garage_right
                  - light.garage_center
                  - light.front_porch_lights
        - conditions:
            - condition: trigger
              id: sunset
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.permanent_outdoor_lights
              data:
                brightness_pct: 50
            - service: light.turn_on
              target:
                entity_id:
                  - light.garage_left
                  - light.garage_right
                  - light.garage_center
                  - light.front_porch_lights
              data:
                brightness_pct: 1
  mode: single

- id: early_morning_lights
  alias: 3:30 AM Light Activation
  trigger:
    - platform: time
      at: "03:30:00"
  condition: []
  action:
    - parallel:
        - sequence:
            - service: light.turn_on
              target:
                entity_id: light.permanent_outdoor_lights
            - service: light.turn_on
              target:
                entity_id:
                  - light.garage_left
                  - light.garage_right
                  - light.garage_center
                  - light.front_porch_lights
              data:
                transition: 3
                brightness_pct: 1
        - service: light.turn_on
          target:
            entity_id:
              - light.sunroom_light
              - light.diningroom_light
              - light.livingroom_light
          data:
            brightness_pct: 10
  mode: single

- id: exterior_led_monthly_effect
  alias: Exterior LED - Monthly Effect
  mode: single
  trigger:
    - platform: time
      at: "00:00:00"
  variables:
    current_month: "{{ now().month }}"
    # Map each month to a Govee effect name on H705A
    monthly_effects:
      1: "LED-January"
      2: "LED-February"
      3: "LED-March"
      4: "LED-April"
      5: "BSMT-Patriotic" # May
      6: "BSMT-Patriotic" # June
      7: "BSMT-Patriotic" # July
      8: "LED-August" # August
      9: "LED-August" # September
      10: "Halloween"
      11: "LED-Thanksgiving"
      12: "Christmas"
  condition: []
  action:
    - variables:
        target_effect: "{{ monthly_effects[current_month] }}"
    # (Optional safety) Only run if the effect actually exists on the device
    - condition: template
      value_template: >
        {{ target_effect in (state_attr('light.permanent', 'effect_list') or []) }}
    - service: light.turn_on
      target:
        entity_id: light.permanent_outdoor_lights
      data:
        effect: "{{ target_effect }}"

- id: interior_lights_sunrise_off
  alias: Interior Lights Off - 15 Minutes After Sunrise
  trigger:
    - platform: sun
      event: sunrise
      offset: "00:15:00"
  condition: []
  action:
    - service: light.turn_off
      target:
        entity_id:
          - light.sunroom_light
          - light.livingroom_light
          - light.diningroom_light
  mode: single
