title: Kiosk
views:

  ###########################################################################
  # 1) SNAPSHOT — high-level snapshot & key items (modern layout)
  ###########################################################################
  - title: Snapshot
    path: snapshot
    icon: mdi:view-dashboard-variant
    type: sections
    max_columns: 3

    badges:
      - entity: sensor.kiosk_snapshot_lights_on
        name: Lights On
      - entity: binary_sensor.kiosk_automations_have_issues
        name: Automations Issues?
      - entity: sensor.hygrometer_humidor_temperature
        name: Humidor °F
      - entity: !secret weather_primary_entity
        name: Weather
      - entity: sensor.huskers_next_game
        name: Next Huskers Game

    sections:
      # --- Hero chips & headline ---
      - type: vertical-stack
        column_span: 3
        cards:
          # Section title
          - type: markdown
            content: "## Snapshot — Overview"

          - type: custom:mushroom-chips-card
            alignment: justify
            chips:
              - type: template
                entity: sensor.kiosk_snapshot_lights_on
                content: "{{ states('sensor.kiosk_snapshot_lights_on') }} lights"
                icon: mdi:lightbulb-group
                icon_color: >
                  {% set n = states('sensor.kiosk_snapshot_lights_on')|int(0) %}
                  {% if n == 0 %} disabled {% elif n < 5 %} amber {% else %} yellow {% endif %}
              - type: template
                entity: binary_sensor.kiosk_automations_have_issues
                content: >
                  {% if is_state('binary_sensor.kiosk_automations_have_issues','on') %}
                    Automations need attention
                  {% else %} Automations healthy {% endif %}
                icon: mdi:robot
                icon_color: >
                  {% if is_state('binary_sensor.kiosk_automations_have_issues','on') %} red {% else %} green {% endif %}
              - type: template
                entity: sensor.hygrometer_humidor_temperature
                content: "{{ states('sensor.hygrometer_humidor_temperature') }}°F humidor"
                icon: mdi:cigar
                icon_color: >
                  {% set t = states('sensor.hygrometer_humidor_temperature')|float(0) %}
                  {% if t < 60 %} blue {% elif t > 75 %} deep-orange {% else %} teal {% endif %}
              - type: entity
                entity: !secret weather_primary_entity
                content_info: state
                icon_color: indigo
              - type: template
                entity: sensor.huskers_kickoff_in_effective
                content: >
                  {% set k = states('sensor.huskers_kickoff_in_effective') %}
                  {{ 'Kickoff TBD' if k in ['unknown','unavailable','','None','none'] else k ~ ' min to kickoff' }}
                icon: mdi:football-helmet
                icon_color: >
                  {% set k = states('sensor.huskers_kickoff_in_effective')|int(9999) %}
                  {% if k <= 60 %} red {% elif k <= 180 %} orange {% else %} green {% endif %}

          - type: custom:mushroom-template-card
            primary: "{{ now().strftime('%A, %B %d') }}"
            secondary: "{{ now().strftime('%I:%M %p') }} · Snapshot: game day, climate, and quick actions."
            icon: mdi:monitor-dashboard
            layout: vertical
            multiline_secondary: true
            tap_action:
              action: none

          # --- Responsive tile grid (key items) ---
          - type: markdown
            content: "### Snapshot — Key Items"

          - type: custom:layout-card
            layout_type: custom:masonry-layout
            layout:
              width: 260
              max_cols: 4
              card_margin: 8px 8px 12px
            cards:
              - type: custom:mushroom-template-card
                entity: sensor.kiosk_snapshot_lights_on
                primary: Lights On
                secondary: "{{ states('sensor.kiosk_snapshot_lights_on')|int(0) }} active fixtures"
                icon: mdi:lightbulb-group
                icon_color: >
                  {% set v = states('sensor.kiosk_snapshot_lights_on')|int(0) %}
                  {% if v == 0 %} disabled {% elif v < 5 %} amber {% else %} yellow {% endif %}
                tap_action:
                  action: more-info

              - type: custom:mushroom-template-card
                entity: sensor.kiosk_snapshot_plugs_on
                primary: Plugs Active
                secondary: "{{ states('sensor.kiosk_snapshot_plugs_on')|int(0) }} running loads"
                icon: mdi:power-plug-outline
                icon_color: teal
                tap_action:
                  action: more-info

              - type: custom:mushroom-template-card
                entity: binary_sensor.kiosk_automations_have_issues
                primary: Automation Health
                secondary: >
                  {% if is_state('binary_sensor.kiosk_automations_have_issues','on') %}
                    Issues detected
                  {% else %} All good {% endif %}
                icon: mdi:robot
                icon_color: >
                  {% if is_state('binary_sensor.kiosk_automations_have_issues','on') %} red {% else %} green {% endif %}
                tap_action:
                  action: more-info

              - type: custom:mushroom-template-card
                entity: sensor.kiosk_snapshot_aux_readout
                primary: Humidor Climate
                secondary: >
                  {% set t = states('sensor.hygrometer_humidor_temperature') %}
                  {% set h = states('sensor.hygrometer_humidor_humidity') %}
                  {{ 'n/a' if t in ['unknown','unavailable',''] else t ~ '°F' }} ·
                  {{ 'n/a' if h in ['unknown','unavailable',''] else h ~ '% RH' }}
                icon: mdi:coolant-temperature
                icon_color: >
                  {% set r = states('sensor.hygrometer_humidor_humidity')|float(0) %}
                  {% if r < 60 %} blue {% elif r > 75 %} deep-orange {% else %} teal {% endif %}
                tap_action:
                  action: more-info

              - type: statistics-graph
                title: Lights & Plugs (24h)
                days_to_show: 1
                period: hour
                chart_type: line
                stat_types:
                  - mean
                  - max
                entities:
                  - entity: sensor.kiosk_snapshot_lights_on
                    name: Lights On
                  - entity: sensor.kiosk_snapshot_plugs_on
                    name: Plugs On

          - type: markdown
            content: "### Snapshot — Automation Health"

          - type: history-graph
            title: Automation Health (24h)
            hours_to_show: 24
            refresh_interval: 0
            entities:
              - binary_sensor.kiosk_automations_have_issues
              - sensor.kiosk_automations_problem_count

      # --- Automations & Diagnostics (buttons + bundles + issues) ---
      - type: vertical-stack
        column_span: 3
        cards:
          - type: markdown
            content: "## Automations & Diagnostics"

          # Buttons grid
          - type: grid
            columns: 4
            square: false
            cards:
              - type: button
                entity: automation.evening_lights_at_sunset
                name: Evening Lights
                icon: mdi:weather-sunset-down
                show_state: true
                tap_action:
                  action: call-service
                  service: automation.trigger
                  target:
                    entity_id: automation.evening_lights_at_sunset
                hold_action:
                  action: toggle
              - type: button
                entity: automation.lighting_night_mode_at_midnight
                name: Night Mode
                icon: mdi:weather-night
                show_state: true
                tap_action:
                  action: call-service
                  service: automation.trigger
                  target:
                    entity_id: automation.lighting_night_mode_at_midnight
                hold_action:
                  action: toggle
              - type: button
                entity: automation.early_morning_lights_03_30
                name: Early Morning
                icon: mdi:alarm
                show_state: true
                tap_action:
                  action: call-service
                  service: automation.trigger
                  target:
                    entity_id: automation.early_morning_lights_03_30
                hold_action:
                  action: toggle
              - type: button
                entity: automation.interior_lights_off_15_minutes_after_sunrise
                name: Interior Sunrise Off
                icon: mdi:weather-sunset-up
                show_state: true
                tap_action:
                  action: call-service
                  service: automation.trigger
                  target:
                    entity_id: automation.interior_lights_off_15_minutes_after_sunrise
                hold_action:
                  action: toggle
              - type: button
                entity: automation.outdoor_lights_control_sunrise_sunset
                name: Exterior Sunrise/Sunset
                icon: mdi:weather-sunny-off
                show_state: true
                tap_action:
                  action: call-service
                  service: automation.trigger
                  target:
                    entity_id: automation.outdoor_lights_control_sunrise_sunset
                hold_action:
                  action: toggle
              - type: button
                entity: automation.exterior_led_monthly_effect
                name: Exterior LED Effect
                icon: mdi:led-strip-variant
                show_state: true
                tap_action:
                  action: call-service
                  service: automation.trigger
                  target:
                    entity_id: automation.exterior_led_monthly_effect
                hold_action:
                  action: toggle
              - type: button
                entity: automation.humidor_plug_temperature_control
                name: Humidor Plug Control
                icon: mdi:cigar
                show_state: true
                tap_action:
                  action: call-service
                  service: automation.trigger
                  target:
                    entity_id: automation.humidor_plug_temperature_control
                hold_action:
                  action: toggle
              - type: button
                entity: automation.safety_turn_off_burner_plugs_at_11_00_pm
                name: Burners Off 23:00
                icon: mdi:fire-off
                show_state: true
                tap_action:
                  action: call-service
                  service: automation.trigger
                  target:
                    entity_id: automation.safety_turn_off_burner_plugs_at_11_00_pm
                hold_action:
                  action: toggle

          # Bundles
          - type: entities
            title: Automation Bundles
            show_header_toggle: false
            entities:
              - entity: group.kiosk_snapshot_automations
                name: Snapshot Bundle
              - entity: group.kiosk_all_automations
                name: Core Bundle
              - entity: sensor.kiosk_snapshot_plugs_on
                name: Active Plugs Count

          # Issues list
          - type: custom:auto-entities
            card:
              type: entities
              title: Automations With Issues
              show_header_toggle: false
            filter:
              include:
                - domain: automation
                  state: unavailable
                - domain: automation
                  state: unknown
              exclude:
                - entity_id: automation.*test*
            sort:
              method: friendly_name
            show_empty: false

  ###########################################################################
  # 2) CONTROL — lights, plugs, relays with status emphasized at the top
  ###########################################################################
  - title: Control
    path: control
    icon: mdi:lightbulb-group
    type: sections
    max_columns: 3
    badges: []

    sections:
      # --- Status row (today runtimes + issues) ---
      - type: grid
        cards:
          - type: markdown
            content: "## Status Today"

          - type: tile
            entity: sensor.kiosk_all_lights_runtime_today
            name: Lights Runtime (min)
            color: amber
          - type: tile
            entity: sensor.kiosk_plug_humidor_on_today
            name: Humidor On (min)
            color: teal
          - type: tile
            entity: sensor.kiosk_plug_mainfloor_burner_on_today
            name: Mainfloor Burner On (min)
            color: teal
          - type: tile
            entity: sensor.kiosk_plug_basement_burner_on_today
            name: Basement Burner On (min)
            color: teal
          - type: tile
            entity: sensor.kiosk_plug_bedroom_burner_on_today
            name: Bedroom Burner On (min)
            color: teal
          - type: tile
            entity: binary_sensor.kiosk_automations_have_issues
            name: Automations Issues?
            color: red

      # --- Eight big light groups ---
      - type: grid
        cards:
          - type: markdown
            content: "## Light Groups"

          - type: custom:hue-like-light-card
            entity: light.all_lights
            name: All Lights
          - type: custom:hue-like-light-card
            entity: light.mainfloor_lights
            name: Main Floor
          - type: custom:hue-like-light-card
            entity: light.all_exterior_lights
            name: Exterior Lights
          - type: custom:hue-like-light-card
            entity: light.permanent_outdoor_lights
            name: Permanent Strip
          - type: custom:hue-like-light-card
            entity: light.theater_lights
            name: Theater
          - type: custom:hue-like-light-card
            entity: light.office_lights
            name: Office
          - type: custom:hue-like-light-card
            entity: light.front_porch_lights
            name: Front Porch
          - type: custom:hue-like-light-card
            entity: light.garage_lights
            name: Garage

      # --- Main floor individuals ---
      - type: grid
        columns: 3
        cards:
          - type: markdown
            content: "## Main Floor Lights"

          - type: custom:compact-light-card
            entity: light.livingroom_light
            name: Living Room
          - type: custom:compact-light-card
            entity: light.diningroom_light
            name: Dining Room
          - type: custom:compact-light-card
            entity: light.sunroom_light
            name: Sunroom

      # --- Upper floor individuals ---
      - type: grid
        columns: 3
        cards:
          - type: markdown
            content: "## Upper Floor Lights"

          - type: custom:compact-light-card
            entity: light.light_parents
            name: Primary
          - type: custom:compact-light-card
            entity: light.light_guest_room
            name: Guest
          - type: custom:compact-light-card
            entity: light.light_attic
            name: Attic

      # --- Theater / Front / Garage individuals ---
      - type: grid
        columns: 3
        cards:
          - type: markdown
            content: "## Theater / Front / Garage"

          - type: custom:compact-light-card
            entity: light.light_theater_left
            name: Theater Left
          - type: custom:compact-light-card
            entity: light.light_theater_right
            name: Theater Right
          - type: custom:compact-light-card
            entity: light.light_front_left
            name: Front Left
          - type: custom:compact-light-card
            entity: light.light_front_right
            name: Front Right
          - type: custom:compact-light-card
            entity: light.light_garage_left
            name: Garage Left
          - type: custom:compact-light-card
            entity: light.light_garage_center
            name: Garage Center
          - type: custom:compact-light-card
            entity: light.light_garage_right
            name: Garage Right
          - type: custom:compact-light-card
            entity: light.light_office
            name: Office

      # --- Plugs & relays ---
      - type: grid
        cards:
          - type: markdown
            content: "## Plugs & Power"

          - type: tile
            entity: switch.plug_basement_burner
            name: Basement Burner
            color: teal
            tap_action:
              action: toggle
            features:
              - type: target-entity
                entity: sensor.plug_basement_burner_power
                name: Power (W)

          - type: tile
            entity: switch.plug_mainfloor_burner
            name: Main Floor Burner
            color: teal
            tap_action:
              action: toggle
            features:
              - type: target-entity
                entity: sensor.plug_mainfloor_burner_power
                name: Power (W)

          - type: tile
            entity: switch.plug_bedroom_burner
            name: Bedroom Burner
            color: teal
            tap_action:
              action: toggle
            features:
              - type: target-entity
                entity: sensor.plug_bedroom_burner_power
                name: Power (W)

          - type: tile
            entity: switch.plug_humidor
            name: Humidor Plug
            color: teal
            tap_action:
              action: toggle
            features:
              - type: target-entity
                entity: sensor.plug_humidor_power
                name: Power (W)

          - type: entities
            title: Light Power Relays
            show_header_toggle: false
            entities:
              - switch.bar_light_power_switch
              - switch.diningroom_light_power_switch
              - switch.livingroom_light_power_switch
              - switch.light_parents_power_switch
              - switch.light_guest_room_power_switch
              - switch.sunroom_light_power_switch
              - switch.light_attic_power_switch
              - switch.permanent_outdoor_lights_power_switch
              - switch.exterior_lights_power_switch
              - switch.outside_power_switch
              - switch.main_power_switch
              - switch.mainfloor_power_switch
              - switch.main_floor_power_switch
              - switch.light_ari_power_switch
              - switch.christmas_tree_lights_power_switch
              - switch.tv_lights_power_switch
              - switch.scenic_dreamview_power_switch
              - switch.scenic_dreamview1_power_switch
              - switch.scenic_dreamview2_power_switch

  ###########################################################################
  # 3) HUMIDOR — live gauges + trends
  ###########################################################################
  - title: Humidor
    path: humidor
    icon: mdi:cigar
    type: sections
    max_columns: 3
    badges: []

    sections:
      - type: grid
        column_span: 3
        cards:
          - type: markdown
            content: "## Humidor — Snapshot"

          - type: chips
            alignment: center
            chips:
              - type: entity
                entity: sensor.hygrometer_humidor_temperature
                name: Temperature
                icon: mdi:thermometer
              - type: entity
                entity: sensor.hygrometer_humidor_humidity
                name: Humidity
                icon: mdi:water-percent
              - type: entity
                entity: switch.plug_humidor
                name: Humidor Power
                icon: mdi:power-plug

          - type: markdown
            content: |
              ### Humidor Snapshot
              Target band: **68–72°F** / **62–68% RH**.

      - type: grid
        column_span: 3
        cards:
          - type: markdown
            content: "## Humidor — Live Readings"

          - type: custom:extended-gauge-card
            title: Temperature
            entity:
              entity: sensor.hygrometer_humidor_temperature
              settings:
                name: Temperature
                unit_of_measurement: degF
                decimals: 1
            main:
              min_value: 55
              max_value: 80
              show_needle: true
              show_entity_name: false
              show_min_max_values: true

          - type: custom:extended-gauge-card
            title: Humidity
            entity:
              entity: sensor.hygrometer_humidor_humidity
              settings:
                name: Humidity
                unit_of_measurement: '%'
                decimals: 0
            main:
              min_value: 50
              max_value: 80
              show_needle: true
              show_entity_name: false
              show_min_max_values: true

          - type: custom:extended-gauge-card
            title: Plug Power
            entity:
              entity: sensor.plug_humidor_power
              settings:
                name: Plug Power
                unit_of_measurement: W
                decimals: 0
            main:
              min_value: 0
              max_value: 150
              show_needle: true
              show_entity_name: false
              show_min_max_values: true

      - type: grid
        column_span: 3
        cards:
          - type: markdown
            content: "## Humidor — Trend Metrics"

          - type: tile
            entity: sensor.kiosk_humidor_temp_delta_1h
            name: Temp Δ (1h)
          - type: tile
            entity: sensor.kiosk_humidor_humidity_delta_1h
            name: Humidity Δ (1h)
          - type: tile
            entity: sensor.kiosk_humidor_in_band_pct_24h
            name: In-Band % (inst)

      - type: grid
        column_span: 3
        cards:
          - type: markdown
            content: "## Humidor — Charts"

          - type: statistics-graph
            title: Temperature & Humidity (7d)
            days_to_show: 7
            period: hour
            chart_type: line
            stat_types:
              - mean
              - min
              - max
            entities:
              - entity: sensor.hygrometer_humidor_temperature
                name: Temperature
              - entity: sensor.hygrometer_humidor_humidity
                name: Humidity

          - type: history-graph
            title: Plug Power & Deltas (48h)
            hours_to_show: 48
            refresh_interval: 0
            entities:
              - sensor.plug_humidor_power
              - sensor.kiosk_humidor_temp_delta_1h
              - sensor.kiosk_humidor_humidity_delta_1h

  ###########################################################################
  # 4) SPRINKLERS — programs, zones, runtime & trends
  ###########################################################################
  - title: Sprinklers
    path: sprinklers
    icon: mdi:sprinkler-variant
    type: sections
    max_columns: 3
    badges:
      - switch.sprinkler_rain_delay
      - sensor.sprinkler_state

    sections:
      - type: vertical-stack
        column_span: 3
        cards:
          - type: markdown
            content: "## Sprinklers — Programs & Rain Delay"

          - type: entities
            title: Programs & Rain Delay
            show_header_toggle: false
            entities:
              - switch.sprinkler_rain_delay
              - switch.sprinkler_scheduled_program
              - switch.sprinkler_midday_program
              - switch.sprinkler_evening_program
              - switch.sprinkler_smart_watering_program

      - type: grid
        columns: 3
        cards:
          - type: markdown
            content: "## Sprinklers — Zones"

          - type: button
            entity: switch.sprinkler_south_side_zone
            name: South Side
            tap_action:
              action: toggle
            hold_action:
              action: more-info
          - type: button
            entity: switch.sprinkler_back_south_zone
            name: Back South
            tap_action:
              action: toggle
            hold_action:
              action: more-info
          - type: button
            entity: switch.sprinkler_back_north_zone
            name: Back North
            tap_action:
              action: toggle
            hold_action:
              action: more-info
          - type: button
            entity: switch.sprinkler_front_zone
            name: Front
            tap_action:
              action: toggle
            hold_action:
              action: more-info
          - type: button
            entity: switch.sprinkler_zone_5_zone
            name: Zone 5
            tap_action:
              action: toggle
            hold_action:
              action: more-info

      - type: grid
        cards:
          - type: markdown
            content: "## Sprinklers — Today's Runtime (minutes)"

          - type: tile
            entity: sensor.kiosk_sprinklers_south_side_runtime_today
            name: South Side
          - type: tile
            entity: sensor.kiosk_sprinklers_back_south_runtime_today
            name: Back South
          - type: tile
            entity: sensor.kiosk_sprinklers_back_north_runtime_today
            name: Back North
          - type: tile
            entity: sensor.kiosk_sprinklers_front_runtime_today
            name: Front
          - type: tile
            entity: sensor.kiosk_sprinklers_zone5_runtime_today
            name: Zone 5

      - type: grid
        cards:
          - type: markdown
            content: "## Sprinklers — Recent History"

          - type: entities
            show_header_toggle: false
            entities:
              - sensor.south_side_zone_history
              - sensor.back_south_zone_history
              - sensor.back_north_zone_history
              - sensor.front_zone_history
              - sensor.zone_5_zone_history

      - type: grid
        column_span: 3
        cards:
          - type: markdown
            content: "## Sprinklers — Trends (7 days)"

          - type: history-graph
            hours_to_show: 168
            entities:
              - sensor.kiosk_sprinklers_south_side_runtime_today
              - sensor.kiosk_sprinklers_back_south_runtime_today
              - sensor.kiosk_sprinklers_back_north_runtime_today
              - sensor.kiosk_sprinklers_front_runtime_today
              - sensor.kiosk_sprinklers_zone5_runtime_today

  ###########################################################################
  # 5) KIOSK ENTITIES — everything tracked in the kiosk package
  ###########################################################################
  - title: Kiosk Entities
    path: kiosk-entities
    icon: mdi:database-eye
    type: sections
    max_columns: 3
    badges: []

    sections:
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## Kiosk Entities — Sensors"

          - type: custom:auto-entities
            card:
              type: entities
              title: Kiosk Sensors
              show_header_toggle: false
            filter:
              include:
                - entity_id: sensor.kiosk_*
            sort:
              method: entity_id

      - type: vertical-stack
        cards:
          - type: markdown
            content: "## Kiosk Entities — Binary Sensors"

          - type: custom:auto-entities
            card:
              type: entities
              title: Kiosk Binary Sensors
              show_header_toggle: false
            filter:
              include:
                - entity_id: binary_sensor.kiosk_*
            sort:
              method: entity_id

      - type: vertical-stack
        cards:
          - type: markdown
            content: "## Kiosk Entities — Groups"

          - type: custom:auto-entities
            card:
              type: entities
              title: Kiosk Groups
              show_header_toggle: false
            filter:
              include:
                - entity_id: group.kiosk_*
            sort:
              method: entity_id

      - type: vertical-stack
        cards:
          - type: markdown
            content: "## Kiosk Entities — Scripts"

          - type: custom:auto-entities
            card:
              type: entities
              title: Kiosk Scripts
              show_header_toggle: false
            filter:
              include:
                - entity_id: script.kiosk_*
            sort:
              method: entity_id
