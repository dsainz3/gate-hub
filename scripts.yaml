# scripts.yaml - Complete Huskers Theater & LED Control System

# =========================================================
# CATEGORY: LED CONTROL
# =========================================================

huskers_led_gameday_start:
  alias: Start Game-Day Effect
  mode: single
  sequence:
    - service: light.turn_on
      target:
        entity_id: light.permanent_outdoor_lights
      data:
        effect: LED_Huskers

huskers_led_stop:
  alias: Stop Effect (Restore Previous)
  mode: single
  sequence:
    - service: light.turn_off
      target:
        entity_id: light.permanent_outdoor_lights

huskers_led_revert_monthly:
  alias: Revert to Monthly Effect
  mode: single
  sequence:
    - service: light.turn_on
      target:
        entity_id: light.permanent_outdoor_lights
      data:
        effect: Monthly

# =========================================================
# CATEGORY: TOUCHDOWN & BURST EFFECTS
# =========================================================

huskers_touchdown_burst:
  alias: 'Huskers: Touchdown Burst (Theater Alternating, Snapshot/Restore)'
  description: 'Fast alternating burst for touchdowns with restore'
  mode: restart
  sequence:
    # Snapshot current state of both theater lights
    - service: scene.create
      data:
        scene_id: huskers_theater_pre_burst
        snapshot_entities:
          - light.light_theater_left
          - light.light_theater_right

    # Burst variables
    - variables:
        flashes: 6 # total swaps (12 color hits)
        on_time: 0.35 # hold time for each color
        trans: 0.25 # smooth transition time

    # Alternate Scarlet <-> Cream
    - repeat:
        count: '{{ flashes }}'
        sequence:
          # Left red, right cream
          - service: light.turn_on
            target:
              entity_id: light.light_theater_left
            data:
              rgb_color: [208, 0, 0] # Nebraska Scarlet
              brightness: 255
              transition: '{{ trans }}'
          - service: light.turn_on
            target:
              entity_id: light.light_theater_right
            data:
              rgb_color: [255, 247, 229] # Nebraska Cream
              brightness: 255
              transition: '{{ trans }}'
          - delay: '{{ on_time }}'

          # Swap: left cream, right red
          - service: light.turn_on
            target:
              entity_id: light.light_theater_left
            data:
              rgb_color: [255, 247, 229] # Nebraska Cream
              brightness: 255
              transition: '{{ trans }}'
          - service: light.turn_on
            target:
              entity_id: light.light_theater_right
            data:
              rgb_color: [208, 0, 0] # Nebraska Scarlet
              brightness: 255
              transition: '{{ trans }}'
          - delay: '{{ on_time }}'

    # Settle and restore the snapshot
    - delay: 0.2
    - service: scene.turn_on
      target:
        entity_id: scene.huskers_theater_pre_burst
      data:
        transition: 1.0

# =========================================================
# CATEGORY: THEATER GAME SHOW (NEW - 5s timing, 2s transitions)
# =========================================================

huskers_theater_game_show_start:
  alias: 'Huskers: Theater Game Show Start'
  description: 'Starts alternating Scarlet/Cream show for theater lights only (5s cycles, 2s transitions)'
  mode: restart
  sequence:
    # Snapshot current theater state
    - service: scene.create
      data:
        scene_id: huskers_theater_game_before
        snapshot_entities:
          - light.light_theater_left
          - light.light_theater_right

    # Set theater show running flag
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.huskers_theater_show_running

    # Log start of show
    - service: logbook.log
      data:
        name: Huskers Theater Game Show
        message: 'Started Huskers theater alternating show - Go Big Red!'

    # Start the alternating loop
    - service: script.turn_on
      target:
        entity_id: script.huskers_theater_game_show_loop

huskers_theater_game_show_loop:
  alias: 'Huskers: Theater Game Show Loop'
  description: 'Alternating pattern: Left (Scarlet→Cream), Right (Cream→Scarlet) - 5s cycles, 2s transitions'
  mode: restart
  sequence:
    - repeat:
        while:
          - condition: state
            entity_id: input_boolean.huskers_theater_show_running
            state: 'on'
        sequence:
          # Phase 1: Left=Scarlet, Right=Cream (5 seconds with 2s transition)
          - parallel:
              - service: light.turn_on
                target:
                  entity_id: light.light_theater_left
                data:
                  rgb_color: [208, 0, 0] # Nebraska Scarlet
                  brightness: 255
                  transition: 2
              - service: light.turn_on
                target:
                  entity_id: light.light_theater_right
                data:
                  rgb_color: [255, 247, 229] # Nebraska Cream
                  brightness: 255
                  transition: 2
          - delay: '00:00:05'

          # Phase 2: Left=Cream, Right=Scarlet (5 seconds with 2s transition)
          - parallel:
              - service: light.turn_on
                target:
                  entity_id: light.light_theater_left
                data:
                  rgb_color: [255, 247, 229] # Nebraska Cream
                  brightness: 255
                  transition: 2
              - service: light.turn_on
                target:
                  entity_id: light.light_theater_right
                data:
                  rgb_color: [208, 0, 0] # Nebraska Scarlet
                  brightness: 255
                  transition: 2
          - delay: '00:00:05'

huskers_theater_game_show_stop:
  alias: 'Huskers: Theater Game Show Stop'
  description: 'Stops theater game show and restores previous lighting'
  sequence:
    # Stop the show
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.huskers_theater_show_running

    # Restore previous state
    - service: scene.turn_on
      target:
        entity_id: scene.huskers_theater_game_before

    # Log completion
    - service: logbook.log
      data:
        name: Huskers Theater Game Show
        message: 'Stopped theater game show and restored previous lighting'

# =========================================================
# CATEGORY: LEGACY THEATER SHOW (PRESERVED - 10s timing)
# =========================================================

huskers_theater_show_start:
  alias: 'Huskers: Theater Show (Start) - Legacy'
  description: 'Original theater show with 10-second timing - preserved for compatibility'
  mode: restart
  sequence:
    - service: scene.create
      data:
        scene_id: huskers_theater_show_restore
        snapshot_entities:
          - light.light_theater_left
          - light.light_theater_right
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.huskers_color_show
    - service: light.turn_on
      target:
        entity_id: light.light_theater_left
      data:
        rgb_color: [255, 247, 229] # Nebraska Cream
        brightness: 255
    - service: light.turn_on
      target:
        entity_id: light.light_theater_right
      data:
        rgb_color: [208, 0, 0] # Nebraska Scarlet
        brightness: 255
    - repeat:
        while:
          - condition: state
            entity_id: input_boolean.huskers_color_show
            state: 'on'
        sequence:
          - service: light.turn_on
            target:
              entity_id: light.light_theater_left
            data:
              rgb_color: [208, 0, 0] # Nebraska Scarlet
              brightness: 255
              transition: 10
          - service: light.turn_on
            target:
              entity_id: light.light_theater_right
            data:
              rgb_color: [255, 247, 229] # Nebraska Cream
              brightness: 255
              transition: 10
          - delay: 10
          - service: light.turn_on
            target:
              entity_id: light.light_theater_left
            data:
              rgb_color: [255, 247, 229] # Nebraska Cream
              brightness: 255
              transition: 10
          - service: light.turn_on
            target:
              entity_id: light.light_theater_right
            data:
              rgb_color: [208, 0, 0] # Nebraska Scarlet
              brightness: 255
              transition: 10
          - delay: 10
    - service: scene.turn_on
      target:
        entity_id: scene.huskers_theater_show_restore
    - service: scene.delete
      target:
        entity_id: scene.huskers_theater_show_restore
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.huskers_color_show

huskers_theater_show_stop:
  alias: 'Huskers: Theater Show (Stop) - Legacy'
  description: 'Stops legacy theater show'
  mode: single
  sequence:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.huskers_color_show

# =========================================================
# CATEGORY: TEST SCRIPTS (PRESERVED)
# =========================================================

huskers_update_last_score_test:
  alias: Update Last Score (Test)
  mode: single
  sequence:
    - service: input_text.set_value
      target:
        entity_id: input_text.huskers_last_score
      data:
        value: 'Test Score Update'

huskers_hail_varsity_show_start:
  alias: 'Huskers: Hail Varsity Show (Start)'
  mode: restart
  sequence: []

huskers_hail_varsity_show_stop:
  alias: 'Huskers: Hail Varsity Show (Stop)'
  mode: restart
  sequence: []

huskers_test_our_score:
  alias: 'Huskers (Test): Our Score'
  mode: single
  sequence: []

huskers_test_opponent_score:
  alias: 'Huskers (Test): Opponent Score'
  mode: single
  sequence: []
